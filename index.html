<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DC 6084 â€” FPA / LPA Dashboard</title>
  <link rel="stylesheet" href="styles.css?v=5">
</head>
<body>

  <!-- ========== HEADER ========== -->
  <header class="header" role="banner">
    <h1>ğŸ“Š DC 6084 â€” FPA / LPA Dashboard</h1>
    <span class="date-badge" aria-label="Report date">No Data Loaded</span>
  </header>

  <!-- ========== TAB NAVIGATION ========== -->
  <nav class="tab-nav" role="tablist" aria-label="Dashboard reports">
    <button
      class="tab-btn"
      id="tab-fpa-lpa"
      role="tab"
      aria-selected="true"
      aria-controls="panel-fpa-lpa"
      tabindex="0"
    >
      FPA / LPA Report
    </button>
    <button
      class="tab-btn"
      id="tab-roster"
      role="tab"
      aria-selected="false"
      aria-controls="panel-roster"
      tabindex="-1"
    >
      Associate Roster
    </button>
  </nav>

  <!-- ========== FILTERS ========== -->
  <section class="filters" aria-label="Report filters">
    <div class="filter-group">
      <label for="filter-area">Area</label>
      <select id="filter-area">
        <option value="All">All Areas</option>
      </select>
    </div>
    <div class="filter-group">
      <label for="filter-shift">Shift</label>
      <select id="filter-shift">
        <option value="All">All Shifts</option>
      </select>
    </div>
    <div class="filter-group">
      <label for="filter-role">Role</label>
      <select id="filter-role">
        <option value="All">All Roles</option>
      </select>
    </div>

    <!-- Roster Upload -->
    <div class="filter-group">
      <label>Roster</label>
      <button id="btn-upload-roster" class="btn-roster" type="button">
        ğŸ‘¥ Upload Roster
      </button>
      <button id="btn-paste-roster" class="btn-paste" type="button">
        ğŸ“‹ Paste Roster
      </button>
      <input type="file" id="file-roster" accept=".xlsx,.xls,.csv" class="sr-only">
    </div>

    <!-- FPA/LPA Import Button -->
    <div class="filter-group">
      <label>Reports</label>
      <button id="btn-open-import" class="btn-import" type="button">
        ğŸ“‚ Load FPA / LPA
      </button>
    </div>
  </section>

  <!-- Roster Status -->
  <div id="roster-status" class="roster-status" role="status"></div>
  <div style="margin:0 24px 4px; text-align:right;">
    <button id="btn-clear-roster" class="btn-clear" type="button">Reset to Sample Roster</button>
  </div>

  <!-- Import Status -->
  <div id="import-status" class="import-status" style="display:none;" role="alert"></div>

  <!-- Roster Paste Modal Overlay -->
  <div id="roster-paste-overlay" class="modal-overlay" style="display:none;"></div>

  <!-- Roster Paste Modal -->
  <div id="roster-paste-modal" class="modal" aria-hidden="true" role="dialog"
       aria-labelledby="roster-paste-title">
    <div class="modal-header">
      <h2 id="roster-paste-title">ğŸ“‹ Paste Roster CSV</h2>
      <button id="btn-close-roster-paste" class="modal-close" aria-label="Close">&times;</button>
    </div>
    <div class="modal-body">
      <p class="modal-desc">Paste your roster CSV data below. Required columns: <strong>User ID, First Name, Last Name, Area, Shift, Role</strong>.<br>
        <em>Tip: Open your CSV/Excel file, select all (Ctrl+A), copy (Ctrl+C), then paste here.</em></p>
      <textarea id="roster-paste-area" class="paste-area" rows="10" 
                placeholder="User ID,First Name,Last Name,Area,Shift,Role&#10;D6-1001,John,Smith,Dry 1st,1st,Orderfiller&#10;D6-1002,Jane,Doe,Dry 1st,1st,Lift Driver"></textarea>
    </div>
    <div class="modal-footer">
      <button id="btn-import-roster-paste" class="btn-primary" type="button">âœ… Import Roster</button>
    </div>
  </div>

  <!-- Import Modal Overlay -->
  <div id="import-modal-overlay" class="modal-overlay" style="display:none;"></div>

  <!-- Import Modal -->
  <div id="import-modal" class="modal" aria-hidden="true" role="dialog"
       aria-labelledby="modal-title">
    <div class="modal-header">
      <h2 id="modal-title">ğŸ“‚ Load FPA / LPA Reports</h2>
      <button id="btn-close-modal" class="modal-close" aria-label="Close">&times;</button>
    </div>
    <div class="modal-body">
      <p class="modal-desc">Upload or paste FPAOF &amp; FPALD report data. Accepts <strong>.xlsx</strong>, <strong>.xls</strong>, or <strong>.csv</strong>.<br>
        Names are matched from the saved <strong>Roster</strong> using User ID.<br>
        <em>ğŸ’¡ If file upload doesn't work, use the paste boxes below.</em></p>

      <div class="modal-file-group">
        <label for="file-fpaof" class="modal-file-label">
          <span class="modal-file-icon">ğŸ“¦</span>
          <span class="modal-file-text">
            <strong>FPAOF</strong> (Orderfillers)
            <small>User ID, Date, FPA Minutes, LPA Minutes</small>
          </span>
        </label>
        <input type="file" id="file-fpaof" accept=".xlsx,.xls,.csv" class="modal-file-input">
        <details class="paste-details">
          <summary>ğŸ“‹ Or paste FPAOF CSV data</summary>
          <textarea id="fpaof-paste-area" class="paste-area" rows="6" 
                    placeholder="User ID,Date,FPA Minutes,LPA Minutes&#10;D6-1001,2026-02-18,12,11&#10;D6-1002,2026-02-18,16,13"></textarea>
        </details>
      </div>

      <div class="modal-file-group">
        <label for="file-fpald" class="modal-file-label">
          <span class="modal-file-icon">ğŸšœ</span>
          <span class="modal-file-text">
            <strong>FPALD</strong> (Lift Drivers)
            <small>User ID, Date, FPA Minutes, LPA Minutes</small>
          </span>
        </label>
        <input type="file" id="file-fpald" accept=".xlsx,.xls,.csv" class="modal-file-input">
        <details class="paste-details">
          <summary>ğŸ“‹ Or paste FPALD CSV data</summary>
          <textarea id="fpald-paste-area" class="paste-area" rows="6" 
                    placeholder="User ID,Date,FPA Minutes,LPA Minutes&#10;D6-1003,2026-02-18,10,14&#10;D6-1005,2026-02-18,15,12"></textarea>
        </details>
      </div>
    </div>
    <div class="modal-footer">
      <button id="btn-run-import" class="btn-primary" type="button">âœ… Import All</button>
    </div>
  </div>

  <!-- ========== FPA / LPA REPORT PANEL ========== -->
  <div
    class="tab-panel"
    id="panel-fpa-lpa"
    role="tabpanel"
    aria-labelledby="tab-fpa-lpa"
    aria-hidden="false"
  >
    <!-- Building Goal Section -->
    <div class="building-goal-section">
      <h2 class="section-title">ğŸ¢ Building Goal</h2>
      <div class="building-goal-cards">
        <div class="building-card building-card--target">
          <div class="building-card-header">Target</div>
          <div class="building-card-body">
            <div class="building-stat">
              <span class="building-label">FPA</span>
              <span class="building-value">â‰¤ 14 min</span>
            </div>
            <div class="building-stat">
              <span class="building-label">LPA</span>
              <span class="building-value">â‰¤ 14 min</span>
            </div>
          </div>
        </div>
        <div class="building-card building-card--fpa">
          <div class="building-card-header">FPA Building Performance</div>
          <div class="building-card-body">
            <div class="building-big-number" id="building-fpa-pct">0%</div>
            <div class="building-subtext"><span id="building-fpa-count">0 / 0</span> on goal</div>
          </div>
        </div>
        <div class="building-card building-card--lpa">
          <div class="building-card-header">LPA Building Performance</div>
          <div class="building-card-body">
            <div class="building-big-number" id="building-lpa-pct">0%</div>
            <div class="building-subtext"><span id="building-lpa-count">0 / 0</span> on goal</div>
          </div>
        </div>
        <div class="building-card building-card--both">
          <div class="building-card-header">Both On Building Goal</div>
          <div class="building-card-body">
            <div class="building-big-number" id="building-both-pct">0%</div>
            <div class="building-subtext"><span id="building-both-count">0 / 0</span> associates</div>
          </div>
        </div>
        <div class="building-card building-card--hours-lost">
          <div class="building-card-header">â±ï¸ Hours Lost (Over Goal)</div>
          <div class="building-card-body">
            <div class="building-big-number" id="building-hours-lost">0.0</div>
            <div class="building-subtext">hours</div>
            <div class="hours-lost-breakdown">
              <span id="hours-lost-fpa">FPA: 0 min</span>
              <span id="hours-lost-lpa">LPA: 0 min</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Summary Cards (Area-Specific) -->
    <h2 class="section-title">ğŸ“Š Area-Specific Performance</h2>
    <div class="summary-cards">
      <div class="card card--blue">
        <div class="card-value" id="card-total">0</div>
        <div class="card-label">Total Associates</div>
      </div>
      <div class="card card--green">
        <div class="card-value" id="card-fpa-above">0 / 0</div>
        <div class="card-label">FPA On Goal (Dry/MP â‰¤14m, FDD â‰¤15m)</div>
      </div>
      <div class="card card--red">
        <div class="card-value" id="card-fpa-off">0 / 0</div>
        <div class="card-label">FPA Off Goal</div>
      </div>
      <div class="card card--green">
        <div class="card-value" id="card-lpa-above">0 / 0</div>
        <div class="card-label">LPA â‰¤ 14 min (On Goal)</div>
      </div>
      <div class="card card--red">
        <div class="card-value" id="card-lpa-off">0 / 0</div>
        <div class="card-label">LPA &gt; 14 min (Off Goal)</div>
      </div>
      <div class="card card--yellow">
        <div class="card-value" id="card-both-above">0 / 0</div>
        <div class="card-label">Both On Goal</div>
      </div>
    </div>

    <!-- Area Breakdown -->
    <h2 class="section-title">ğŸ¢ Breakdown by Area</h2>
    <div class="table-container">
      <table aria-label="FPA and LPA breakdown by area">
        <thead>
          <tr>
            <th scope="col">Shift</th>
            <th scope="col">Area</th>
            <th scope="col">Total</th>
            <th scope="col">FPA On Goal</th>
            <th scope="col">FPA %</th>
            <th scope="col">LPA On Goal</th>
            <th scope="col">LPA %</th>
          </tr>
        </thead>
        <tbody id="area-breakdown-tbody"></tbody>
      </table>
    </div>

    <!-- Score Cards per Area + Shift -->
    <h2 class="section-title">ğŸ† Score Cards by Area &amp; Shift <span style="font-weight:400;font-size:0.85rem;color:#555;">(click to expand)</span></h2>
    <div id="scorecards-container" class="scorecards-container"></div>

    <!-- Full Data Table -->
    <h2 class="section-title">ğŸ“‹ All FPA / LPA Data</h2>
    <div class="table-container">
      <table aria-label="Complete FPA and LPA data for all associates">
        <thead id="fpa-lpa-thead"></thead>
        <tbody id="fpa-lpa-tbody"></tbody>
      </table>
    </div>
  </div>

  <!-- ========== ASSOCIATE ROSTER PANEL ========== -->
  <div
    class="tab-panel"
    id="panel-roster"
    role="tabpanel"
    aria-labelledby="tab-roster"
    aria-hidden="true"
  >
    <div class="summary-cards">
      <div class="card card--blue">
        <div class="card-value" id="roster-count">0</div>
        <div class="card-label">Associates in Roster</div>
      </div>
    </div>

    <div id="roster-filter-indicator" class="roster-filter-indicator" role="status" style="display:none;"></div>
    <h2 class="section-title">ğŸ‘¥ Associate Roster</h2>
    <div class="table-container">
      <table aria-label="Associate roster">
        <thead>
          <tr>
            <th scope="col">User ID</th>
            <th scope="col">First Name</th>
            <th scope="col">Last Name</th>
            <th scope="col">Area</th>
            <th scope="col">Shift</th>
            <th scope="col">Role</th>
          </tr>
        </thead>
        <tbody id="roster-tbody"></tbody>
      </table>
    </div>
  </div>

  <!-- Scripts -->
  <script src="data.js?v=5"></script>
  <script src="app.js?v=5"></script>
  <script src="import.js?v=5"></script>
  <script async src="https://cdn.sheetjs.com/xlsx-0.20.3/package/dist/xlsx.full.min.js" 
          onerror="console.warn('SheetJS CDN blocked - CSV-only mode');"></script>
</body>
</html>
